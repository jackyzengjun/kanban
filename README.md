# 代维系统费用结算数据看板

## 功能概述

本系统提供了一个动态的数据看板，支持通过CSV文件加载月度数据，实现数据的灵活管理和可视化展示。

## CSV数据模板使用说明

### 1. 模板文件

- **文件名**: `monthly_data_template.csv`
- **编码**: UTF-8
- **分隔符**: 逗号(,)

### 2. 数据格式说明

#### 必填字段

| 字段名 | 说明 | 示例 |
|--------|------|------|
| 年月 | YYYY-MM格式 | 2024-01 |
| 总费用 | 单位：万元 | 358.07 |
| 总费用变化率 | 百分比，不含%符号 | 15.2 |
| 总次数 | 单位：万次 | 6.2 |
| 总次数变化率 | 百分比，不含%符号 | 8.3 |
| 平均费用 | 单位：万元 | 2.2 |
| 平均费用变化率 | 百分比，不含%符号 | 18.5 |
| 铁通评分 | 0-100分 | 89 |
| 铁通评分变化 | 变化值 | 6.2 |
| 嘉环评分 | 0-100分 | 85 |
| 嘉环评分变化 | 变化值 | 4.1 |

#### 占比数据字段

**按次费用占比**:
- 按次铁通占比 (0-100)
- 按次嘉环占比 (0-100)
- 按次家客占比 (0-100)
- 按次集客占比 (0-100)
- 按次线路占比 (0-100)
- 按次无线占比 (0-100)

**包年费用占比**:
- 包年铁通占比 (0-100)
- 包年嘉环占比 (0-100)
- 包年家客占比 (0-100)
- 包年集客占比 (0-100)
- 包年线路占比 (0-100)
- 包年无线占比 (0-100)

### 3. 数据填写规则

1. **年月格式**: 必须使用 `YYYY-MM` 格式，如 `2024-01`
2. **数值精度**: 费用保留2位小数，占比为整数
3. **占比总和**: 同类型占比总和应为100%
4. **排序**: 数据按年月升序排列
5. **完整性**: 每行数据必须包含所有字段

### 4. 示例数据行

```csv
年月,总费用,总费用变化率,总次数,总次数变化率,平均费用,平均费用变化率,铁通评分,铁通评分变化,嘉环评分,嘉环评分变化,按次铁通占比,按次嘉环占比,按次家客占比,按次集客占比,按次线路占比,按次无线占比,包年铁通占比,包年嘉环占比,包年家客占比,包年集客占比,包年线路占比,包年无线占比
2024-01,358.07,15.2,6.2,8.3,2.2,18.5,89,6.2,85,4.1,68,32,38,25,20,17,62,38,42,28,18,12
```

## 接口功能说明

### 1. CSV加载器 (CSVLoader)

#### 主要方法

- `loadCSV(filePath)`: 加载CSV文件
- `parseCSV(csvText)`: 解析CSV文本
- `getAvailableMonths()`: 获取可用月份列表
- `getMonthData(monthKey)`: 获取指定月份数据
- `updateMonthSelector(selectorId, defaultMonth)`: 更新月份选择器

#### 使用示例

```javascript
// 加载CSV数据
const csvData = await csvLoader.loadCSV('./monthly_data_template.csv');

// 获取可用月份
const months = csvLoader.getAvailableMonths();

// 获取特定月份数据
const monthData = csvLoader.getMonthData('2024-12');
```

### 2. 数据刷新功能

- **手动刷新**: 点击页面右上角的"刷新数据"按钮
- **自动加载**: 页面加载时自动尝试加载CSV数据
- **降级处理**: CSV加载失败时自动使用内置默认数据

### 3. 动态月份选择

- 月份选择器会根据CSV文件中的数据自动生成选项
- 支持跨年份数据显示
- 默认选中当前月份或最新月份

## 部署说明

### 1. 文件结构

```
看板/
├── index.html              # 主页面
├── styles.css              # 样式文件
├── script.js               # 主要逻辑
├── csv-loader.js           # CSV加载器
├── chart-lib.js            # 图表库
├── monthly_data_template.csv # 数据模板
└── README.md               # 说明文档
```

### 2. 环境要求

- 现代浏览器 (支持ES6+)
- 本地服务器或Web服务器环境
- CSV文件需要与HTML文件在同一目录或可访问路径

### 3. 启动方式

1. **本地开发**:
   ```bash
   # 使用Python启动简单服务器
   python -m http.server 8000
   
   # 或使用Node.js
   npx serve .
   ```

2. **生产部署**:
   - 将所有文件上传到Web服务器
   - 确保CSV文件路径正确
   - 配置适当的MIME类型支持

## 数据更新流程

### 1. 准备数据

1. 打开 `monthly_data_template.csv` 文件
2. 按照模板格式填入新的月度数据
3. 确保数据格式正确，占比总和为100%
4. 保存文件（UTF-8编码）

### 2. 更新看板

1. 刷新浏览器页面，或
2. 点击"刷新数据"按钮
3. 系统会自动加载新数据并更新显示

### 3. 验证数据

1. 检查月份选择器是否包含新数据
2. 切换到新月份查看数据是否正确
3. 验证图表和指标卡片显示

## 故障排除

### 常见问题

1. **CSV加载失败**
   - 检查文件路径是否正确
   - 确认文件编码为UTF-8
   - 验证CSV格式是否符合要求

2. **数据显示异常**
   - 检查数值格式是否正确
   - 确认占比数据总和为100%
   - 验证年月格式是否为YYYY-MM

3. **月份选择器为空**
   - 确认CSV文件中有有效数据行
   - 检查年月列格式是否正确
   - 查看浏览器控制台错误信息

### 调试方法

1. 打开浏览器开发者工具
2. 查看Console标签页的错误信息
3. 检查Network标签页的文件加载状态
4. 使用断点调试JavaScript代码

## 扩展功能

### 1. 支持多个CSV文件

可以修改代码支持加载多个CSV文件，实现不同数据源的切换。

### 2. 数据导出功能

可以添加将当前显示数据导出为Excel或PDF的功能。

### 3. 实时数据更新

可以集成WebSocket或定时轮询实现数据的实时更新。

### 4. 数据验证

可以添加更严格的数据验证规则，确保数据质量。

---

**注意**: 请确保CSV文件的数据准确性，系统会直接使用文件中的数据进行展示，不会进行额外的数据校验。